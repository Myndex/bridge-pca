/*

/////    SAPC APCA - Advanced Perceptual Contrast Algorithm
/////           bridge-pca  0.1.4  ? BRIDGE contrast function only
/////           DIST: W3 ? Revision date: Dec 21, 2021
/////    Function to parse color values and determine Lc contrast
/////    Copyright © 2019-2021 by Andrew Somers. All Rights Reserved.
/////    LICENSE: W3 LICENSE
/////    CONTACT: Please use the ISSUES or DISCUSSIONS tab at:
/////    https://github.com/Myndex/SAPC-APCA/
/////
///////////////////////////////////////////////////////////////////////////////
/////
/////    IMPORT:
/////    import {
/////            BPCAcontrast, sRGBtoY, displayP3toY, colorParsley
/////            } from 'bridge-pca';
/////    
/////    FORWARD CONTRAST USAGE:
/////    Lc = BPCAcontrast( sRGBtoY( TEXTcolor ) , sRGBtoY( BACKGNDcolor ) );
/////
/////    Where the colors are sent as an rgba array [0,0,0]
/////
/////    Live Demonstrator at https://www.myndex.com/BPCA/
// */
function BPCAcontrast(a,b,c){c=void 0===c?-1:c;var d=[0,1.1];if(isNaN(a)||isNaN(b)||Math.min(a,b)<d[0]||Math.max(a,b)>d[1])return 0;d="BoW";a=.022<a?a:a+Math.pow(.022-a,1.414);b=.022<b?b:b+Math.pow(.022-b,1.414);if(5E-4>Math.abs(b-a))return 0;b>a?(b=1.14*(Math.pow(b,.56)-Math.pow(a,.57)),a=.1>b?0:b-.027):(d="WoB",b=1.14*(Math.pow(b,.65)-Math.pow(a,.62)),a=.1414*Math.max(0,a/.84-1),a=-.1<b?0:b+.027+a);if(0>c)return 100*a;if(0==c)return Math.round(100*Math.abs(a))+"<sub>"+d+"</sub>";if(Number.isInteger(c))return(100*
a).toFixed(c);throw"Err-3";}function bridgeRatio(a,b,c){b=void 0===b?" to 1":b;c=void 0===c?1:c;a=Math.max(0,Math.abs(.01*parseFloat(void 0===a?0:a)));a=1.113946*(Math.pow(a+-.0561,4.537)+.2693)*a+.0837;a=.3<a?10*a:10*a-(Math.pow(.3-a+.42,.48)-.6594);return a.toFixed(c)+b}function sRGBtoY(a){a=void 0===a?[0,0,0]:a;return.212647813391364*Math.pow(a[0]/255,2.4)+.715179147533615*Math.pow(a[1]/255,2.4)+.0721730390750208*Math.pow(a[2]/255,2.4)}
function displayP3toY(a){a=void 0===a?[0,0,0]:a;return.228982959480578*Math.pow(a[0]/255,2.4)+.691749262585238*Math.pow(a[1]/255,2.4)+.0792677779341829*Math.pow(a[2]/255,2.4)}function adobeRGBtoY(a){a=void 0===a?[0,0,0]:a;return.297355022711381*Math.pow(a[0]/255,2.35)+.627372749714528*Math.pow(a[1]/255,2.35)+.0752722275740913*Math.pow(a[2]/255,2.35)}
function alphaBlend(a,b,c){a=void 0===a?[0,0,0,1]:a;b=void 0===b?[0,0,0]:b;c=void 0===c?!0:c;if(a[3]){a[3]=Math.max(Math.min(a[3],1),0);var d=1-a[3],e=[0,0,0];for(i=0;3>i;i++)e[i]=b[i]*d+a[i]*a[3],c&&(e[i]=Math.min(Math.round(e[i]),255));return e}return a}function calcBPCA(a,b,c,d){c=void 0===c?-1:c;d=void 0===d?!0:d;b=colorParsley(b);a=colorParsley(a);""!=a[3]&&1>a[3]&&(a=alphaBlend(a,b,d));return BPCAcontrast(sRGBtoY(a),sRGBtoY(b),c)}
module.exports={BPCAcontrast:BPCAcontrast,bridgeRatio:bridgeRatio,sRGBtoY:sRGBtoY,displayP3toY:displayP3toY,adobeRGBtoY:adobeRGBtoY,alphaBlend:alphaBlend,calcBPCA:calcBPCA};